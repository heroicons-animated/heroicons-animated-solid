import { Motion } from "solid-motionone";
import type { JSX } from "solid-js";
import { createSignal, mergeProps, splitProps } from "solid-js";
import { resolveValues, resolveTransition } from "@/lib/motion-compat";
import { cn } from "@/lib/utils";

export interface CurrencyPoundIconHandle {
  startAnimation: () => void;
  stopAnimation: () => void;
}

interface CurrencyPoundIconProps extends JSX.HTMLAttributes<HTMLDivElement> {
  size?: number;
  ref?: (handle: CurrencyPoundIconHandle) => void;
}

const ROTATE_VARIANTS = {
  normal: {
    scaleX: 1,
  },
  animate: {
    scaleX: [1, -1, 1],
    transition: {
      duration: 0.6,
      ease: "easeInOut",
    },
  },
};
const CurrencyPoundIcon = (rawProps: CurrencyPoundIconProps) => {
  const props = mergeProps({ size: 28 }, rawProps);
  const [local, others] = splitProps(props, [
    "onMouseEnter", "onMouseLeave", "class", "size", "ref",
  ]);
  const [variant, setVariant] = createSignal("normal");
  let isControlled = false;

  if (local.ref) {
    isControlled = true;
    local.ref({
      startAnimation: () => setVariant("animate"),
      stopAnimation: () => setVariant("normal"),
    });
  }

  const handleMouseEnter: JSX.EventHandler<HTMLDivElement, MouseEvent> = (e) => {
    if (isControlled) {
      if (typeof local.onMouseEnter === "function") local.onMouseEnter(e);
    } else {
      setVariant("animate");
    }
  };

  const handleMouseLeave: JSX.EventHandler<HTMLDivElement, MouseEvent> = (e) => {
    if (isControlled) {
      if (typeof local.onMouseLeave === "function") local.onMouseLeave(e);
    } else {
      setVariant("normal");
    }
  };

  return (
    <div
      class={cn(local.class)}
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
      {...others}
    >
      <Motion.svg
        animate={resolveValues(ROTATE_VARIANTS, variant())}
        transition={resolveTransition(ROTATE_VARIANTS, variant())}
              fill="none"
              height={local.size}
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              style={{ "origin-x": "50%", "origin-y": "50%" }}
              viewBox="0 0 24 24"
              width={local.size}
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M14.1213 7.62877C12.9497 6.45719 11.0503 6.45719 9.87868 7.62877C9.37424 8.13321 9.08699 8.7726 9.01694 9.43073C8.9944 9.64251 9.01512 9.85582 9.04524 10.0667L9.5512 13.6084C9.68065 14.5146 9.5307 15.4386 9.12135 16.2573L9 16.5L10.5385 15.9872C11.0003 15.8332 11.4997 15.8332 11.9615 15.9872L12.6158 16.2053C13.182 16.394 13.7999 16.3501 14.3336 16.0832L15 15.75M8.25 12H12M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" />
            </Motion.svg>
    </div>
  );
};

export { CurrencyPoundIcon };
